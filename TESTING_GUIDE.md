# CHU TEA 完整功能测试指南

## 🎯 功能清单

### ✅ 已开发完成的功能

1. **商品详情弹窗**
   - 杯型选择：中杯₽300 | 大杯₽400
   - 温度选择：冷的 | 热的
   - 糖度选择：正常糖 | 少糖 | 半糖 | 无糖
   - 小料选择：无 | 珍珠+¥3 | 椰果+¥3 | 布丁+¥4 | 红豆+¥3 | 芋圆+¥4
   - 两个按钮：🟢 加入购物车 | 🟠 直接购买

2. **购物车功能**
   - 添加商品到购物车
   - 修改数量
   - 删除商品
   - 查看总价
   - 进入结算

3. **结算页面**
   - 优惠券选择器
   - 积分抵扣选项
   - 优惠券和积分互斥逻辑
   - 积分不足时按钮变灰
   - 配送方式选择
   - 备注输入

4. **优惠券系统**
   - 满100减50优惠券
   - 可以和现金/卡支付一起使用
   - 不能和积分同时使用
   - 自动计算折扣

5. **积分系统**
   - 1积分 = 1卢布
   - 只能完全抵扣
   - 积分不足时显示提示
   - 不能和优惠券同时使用

6. **取件码系统**
   - 格式：T + 4位数字
   - 显示在订单详情
   - 显示在电视大屏

7. **电视大屏展示**
   - 访问：http://43.166.239.99:3000/display
   - 实时显示取件码
   - 自动刷新
   - 按状态分类

---

## 🧪 测试账号

### 数据库中的测试用户
- **OpenID**: `test_user_001`
- **用户名**: 测试用户
- **积分**: 1000
- **优惠券**: 10张（满100减50）

---

## 📱 测试步骤

### 方法1：在Telegram中测试（推荐）

1. **打开Telegram Bot**
   - 找到您的CHU TEA Bot
   - 点击"启动"或"Start"

2. **测试商品详情**
   - 点击"Order"进入商品列表
   - 点击任意商品查看详情弹窗
   - 验证选项顺序和价格

3. **测试购物车**
   - 选择选项后点击"加入购物车"
   - 查看购物车图标是否显示数量
   - 进入购物车页面
   - 测试修改数量、删除商品

4. **测试结算**
   - 在购物车点击"结算"
   - 查看优惠券选择器
   - 查看积分抵扣选项
   - 测试互斥逻辑

5. **测试优惠券**
   - 订单金额 ≥ 100₽时
   - 点击"选择优惠券"
   - 选择一张优惠券
   - 验证折扣计算

6. **测试积分**
   - 订单金额 ≤ 1000₽时
   - 勾选"使用积分"
   - 验证金额变为0
   - 验证优惠券选项被禁用

7. **测试直接购买**
   - 在商品详情点击"直接购买"
   - 验证是否直接跳转到结算页面

8. **测试取件码**
   - 完成支付后
   - 查看订单详情
   - 验证取件码格式（T + 4位数字）

9. **测试电视大屏**
   - 在浏览器打开：http://43.166.239.99:3000/display
   - 验证订单显示
   - 验证取件码显示

### 方法2：在浏览器中测试（有限功能）

**注意**：浏览器中使用的是开发模式，看不到真实的优惠券和积分数据。

1. 访问：http://43.166.239.99:3000
2. 可以测试：
   - ✅ 商品详情弹窗
   - ✅ 选项选择
   - ✅ 价格计算
   - ❌ 优惠券（数据为0）
   - ❌ 积分（数据为0）

---

## ✅ 验证清单

### 商品详情弹窗
- [ ] 弹窗在屏幕中间显示
- [ ] 选项顺序：杯型→温度→糖度→小料
- [ ] 中杯价格：₽300
- [ ] 大杯价格：₽400
- [ ] 小料加价正确（+¥3或+¥4）
- [ ] 已选规格显示正确
- [ ] 总价计算正确
- [ ] 加入购物车按钮（绿色）
- [ ] 直接购买按钮（橙色）

### 购物车
- [ ] 商品添加成功
- [ ] 数量修改正常
- [ ] 删除商品正常
- [ ] 总价计算正确
- [ ] 结算按钮可用

### 结算页面
- [ ] 优惠券选择器显示
- [ ] 积分选项显示
- [ ] 订单金额 ≥ 100₽时可选优惠券
- [ ] 订单金额 ≤ 1000₽时可选积分
- [ ] 选择优惠券后积分被禁用
- [ ] 选择积分后优惠券被禁用
- [ ] 积分不足时按钮变灰
- [ ] 显示"（积分不足）"提示

### 优惠券
- [ ] 可以选择优惠券
- [ ] 折扣计算正确（-50₽）
- [ ] 最终金额正确
- [ ] 可以取消选择

### 积分
- [ ] 可以勾选使用积分
- [ ] 最终金额变为0
- [ ] 显示将使用的积分数
- [ ] 可以取消勾选

### 订单
- [ ] 订单创建成功
- [ ] 取件码格式正确（T + 4位数字）
- [ ] 订单详情显示完整
- [ ] 优惠券标记为已使用
- [ ] 积分扣除正确

### 电视大屏
- [ ] 页面正常显示
- [ ] 取件码显示正确
- [ ] 自动刷新
- [ ] 按状态分类显示

---

## 🐛 已知问题

### 浏览器测试限制
- 浏览器中使用的是开发模式用户（Dev User）
- 开发用户没有优惠券和积分数据
- 需要在Telegram中测试才能看到完整功能

### 解决方案
- 使用Telegram Bot测试
- 或者手动给开发用户添加测试数据

---

## 📊 测试数据验证

### 数据库查询命令

```sql
-- 查询测试用户信息
SELECT id, openId, name, availablePoints 
FROM users 
WHERE openId = 'test_user_001';

-- 查询测试用户的优惠券
SELECT COUNT(*) as coupon_count
FROM userCoupons 
WHERE userId = (SELECT id FROM users WHERE openId = 'test_user_001')
AND status = 'available';

-- 查询商品价格
SELECT id, nameZh, nameRu, basePrice 
FROM products 
WHERE id IN (1, 2, 3, 4, 5, 6, 7, 8);

-- 查询大杯加价
SELECT poi.nameZh, poi.priceAdjust
FROM productOptionItems poi
INNER JOIN productOptions po ON poi.optionId = po.id
WHERE po.groupType = 'size' 
AND poi.nameEn LIKE '%Large%'
LIMIT 3;
```

---

## 🎉 测试成功标准

1. ✅ 商品详情弹窗显示正确
2. ✅ 价格计算正确（中杯₽300，大杯₽400）
3. ✅ 购物车功能正常
4. ✅ 优惠券选择和折扣计算正确
5. ✅ 积分抵扣功能正常
6. ✅ 优惠券和积分互斥逻辑正确
7. ✅ 积分不足时按钮变灰
8. ✅ 订单创建成功
9. ✅ 取件码格式正确
10. ✅ 电视大屏显示正常

---

## 📞 技术支持

如果测试中遇到问题，请提供：
1. 测试步骤
2. 期望结果
3. 实际结果
4. 截图（如果可能）
