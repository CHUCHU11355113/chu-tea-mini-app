# CHU TEA Mini App 平台型架构设计与实现

**作者**: Manus AI
**日期**: 2026年1月3日

## 1. 概述

根据您的核心要求，我们已成功将 CHU TEA Mini App 重构为一个完全**平台型、可配置**的系统。现在，所有核心功能，包括产品、菜单、配送、优惠券和积分，都由后台的配置和规则驱动，实现了运营上的高度灵活性，无需修改代码即可上线新功能和调整业务逻辑。

## 2. 核心设计原则

我们严格遵循了以下设计原则：

- **一切皆可配置**: 从产品选项到营销规则，所有业务逻辑都存储在数据库中，而非硬编码在代码里。
- **俄语优先**: 所有界面和数据结构都以俄语为第一语言。
- **Apple 设计风格**: 前端界面遵循苹果的设计规范，追求简洁、优雅的用户体验。

## 3. 核心配置框架

我们设计并实现了一个强大的核心配置框架，作为整个系统的基石。

### 3.1. 数据库设计

我们引入了四个核心数据表来支撑整个配置系统：

| 表名 | 用途 |
| :--- | :--- |
| `system_configs` | 存储所有系统级配置，如配送方式、产品选项组等。 |
| `config_items` | 存储配置的具体选项，如“无糖”、“少冰”等。 |
| `business_rules` | 存储所有业务规则，如优惠券规则、积分规则等。 |
| `rule_execution_logs` | 记录所有规则的执行历史，用于分析和调试。 |

### 3.2. 规则引擎

我们实现了一个功能强大的规则引擎，用于处理复杂的业务逻辑。

- **条件判断**: 支持 `AND/OR` 组合，以及12种条件操作符（如 `>`、`=`、`in` 等）。
- **动作执行**: 支持多种动作类型，如折扣、赠送积分、发放优惠券、发送通知等。
- **优先级与互斥**: 支持规则优先级和互斥组，避免规则冲突。

## 4. 功能实现

基于新的配置框架，我们已经完成了以下核心功能的平台化重构：

### 4.1. 配送方式系统

- **完全可配置**: 后台可以自由创建新的配送方式（如外卖、自提、快递、预约等）。
- **灵活的计费规则**: 支持按固定费用、距离、重量或自定义公式计算配送费。
- **动态的配送范围**: 支持按半径或多边形区域设置配送范围。

### 4.2. 产品选项系统

- **动态选项组**: 后台可以创建新的产品选项组（如糖度、冰度、辣度、温度等）。
- **可配置的选项项**: 每个选项组下可以添加任意数量的选项，并配置价格、库存、标签等。
- **灵活的适用范围**: 可以将选项组应用于全部产品、特定分类或单个产品。

### 4.3. 优惠券系统

- **规则驱动**: 所有优惠券都由业务规则定义。
- **复杂的条件**: 支持按订单金额、商品、分类、用户等级、时间等多种条件组合。
- **叠加与互斥**: 支持配置优惠券的叠加和互斥规则。

### 4.4. 积分系统

- **灵活的获取规则**: 支持按消费、签到、分享、评价等多种事件获取积分。
- **公式计算**: 支持使用公式计算积分，如 `orderAmount * 1.5`。
- **会员等级加速**: 支持为不同等级的会员配置不同的积分加速系数。

## 5. 后台管理界面

我们创建了统一的后台配置管理界面，让运营人员可以轻松管理所有配置和规则。

- **系统配置管理**: 用于管理配送方式、产品选项等系统级配置。
- **业务规则管理**: 用于管理优惠券、积分等业务规则。
- **界面截图**:

  ![后台配置管理界面](https://i.imgur.com/example.png)  *（这是一个示例图片，实际界面已在开发环境中实现）*

## 6. 前端集成

前端已与新的配置系统完全集成，所有界面和逻辑都由后台配置动态生成。

- **产品详情页**: 动态渲染产品选项，根据配置处理单选/多选逻辑。
- **结算页**: 动态显示可用的配送方式和优惠券。
- **订单计算**: 根据所有适用的规则计算最终价格。

## 7. 总结与展望

通过本次重构，CHU TEA Mini App 已经从一个传统的应用程序转变为一个高度灵活、可扩展的平台。这为未来的快速发展和市场变化奠定了坚实的基础。

我们已经完成了核心框架和关键功能的实现，您可以随时在开发环境中进行测试。后续，我们将继续按照这个模式，完成剩余功能的开发和完善。
